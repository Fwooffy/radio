<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Radio</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 720px; margin: 40px auto; padding: 0 16px; }
    .card { padding: 20px; border: 1px solid #ddd; border-radius: 12px; }
    h1 { margin-top: 0; }
    .row { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
    .meta { margin-top: 12px; color: #333; }
    .label { color: #666; font-size: 14px; }
    button { padding: 10px 14px; border-radius: 10px; border: 1px solid #ccc; background: #fff; cursor: pointer; }
  </style>
</head>
<body>
  <div class="card">
    <h1>ðŸ“» My Radio</h1>

    <div class="row">
      <button id="playBtn">Play</button>
      <button id="stopBtn">Stop</button>

      <audio id="player" preload="none" controls style="flex: 1; min-width: 260px;">
        <source src="https://radio.yourdomain.com/stream.mp3" type="audio/mpeg">
      </audio>
    </div>

    <div class="meta">
      <div class="label">Now playing</div>
      <div id="nowPlaying">Loadingâ€¦</div>
    </div>
  </div>

  <script>
    const player = document.getElementById('player');
    const playBtn = document.getElementById('playBtn');
    const stopBtn = document.getElementById('stopBtn');
    const nowPlaying = document.getElementById('nowPlaying');

    playBtn.onclick = () => player.play();
    stopBtn.onclick = () => { player.pause(); player.currentTime = 0; };

    async function fetchNowPlaying() {
      try {
        // Icecast JSON status endpoint:
        const res = await fetch('https://radio.yourdomain.com/status-json.xsl', { cache: 'no-store' });
        const data = await res.json();

        // Works for common Icecast layouts
        const src = data?.icestats?.source;
        const source = Array.isArray(src) ? src.find(s => s.listenurl?.includes('stream.mp3')) : src;

        const title = source?.title || source?.server_name || 'On air';
        nowPlaying.textContent = title;
      } catch (e) {
        nowPlaying.textContent = 'On air (metadata unavailable)';
      }
    }

    fetchNowPlaying();
    setInterval(fetchNowPlaying, 10000);
  </script>
</body>
</html>
